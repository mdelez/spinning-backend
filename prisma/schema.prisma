datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id          String   @id @default(uuid())
  email       String   @unique
  firstName   String
  lastName    String
  dateOfBirth DateTime
  shoeSize    Int
  instructor  Boolean  @default(false)
  admin       Boolean  @default(false)
  createdAt   DateTime @default(now())

  bookings Booking[]
  sessions Session[]
}

model Studio {
  id           String @id @default(uuid())
  studioNumber Int    @unique
  name         String

  bikes    Bike[]
  sessions Session[]
}

model Bike {
  id         String @id @default(uuid())
  studioId   String
  bikeNumber Int

  studio   Studio    @relation(fields: [studioId], references: [id])
  bookings Booking[]

  @@unique([studioId, bikeNumber])
}

model Session {
  id           String   @id @default(uuid())
  instructorId String   @map("userId")
  studioId     String
  startAt      DateTime
  endAt        DateTime
  name         String
  description  String

  instructor User      @relation(fields: [instructorId], references: [id])
  bookings   Booking[]
  studio     Studio    @relation(fields: [studioId], references: [id])
}

model Booking {
  id                 String   @id @default(uuid())
  userId             String
  sessionId          String
  bikeId             String
  friendEmail        String?
  friendName         String?
  friendShoeSize     Int?
  friendWaiverSigned Boolean?
  paid               Boolean  @default(false)
  createdAt          DateTime @default(now())

  user    User    @relation(fields: [userId], references: [id])
  session Session @relation(fields: [sessionId], references: [id])
  bike    Bike    @relation(fields: [bikeId], references: [id])

  @@unique([sessionId, bikeId])
}
